# Инструкция по настройке базы данных SQLite

## Что было сделано

Мы подключили SQLite базу данных к проекту вместо хранения данных в JSON файле.

### Изменения:
- ✅ Добавлена библиотека Flask-SQLAlchemy в `requirements.txt`
- ✅ Создана модель базы данных `models.py` (класс Dish)
- ✅ Обновлён `app.py` для работы с базой данных
- ✅ Создан скрипт миграции `migrate_to_db.py`

## Шаги для запуска

### 1. Установите зависимости

Откройте терминал в папке `backend` и выполните:

```bash
pip install -r requirements.txt
```

Это установит Flask-SQLAlchemy и другие необходимые библиотеки.

### 2. Запустите миграцию данных

Миграция перенесёт все данные из JSON файла в базу данных SQLite:

```bash
python migrate_to_db.py
```

Скрипт:
- Создаст файл `database.db` в папке `backend`
- Создаст таблицу `dishes` 
- Скопирует все блюда из `menu-database.json` в базу данных

**Важно:** Если в базе уже есть данные, скрипт спросит, удалить ли их перед загрузкой.

### 3. Запустите сервер

```bash
python app.py
```

Теперь все API запросы будут работать с базой данных SQLite вместо JSON файла.

## Структура базы данных

### Таблица `dishes`

| Колонка       | Тип      | Описание                           |
|---------------|----------|------------------------------------|
| id            | String   | Уникальный ID блюда (основной ключ)|
| menu          | String   | Название меню                      |
| section       | String   | Раздел меню                        |
| title         | String   | Название блюда                     |
| description   | Text     | Описание блюда                     |
| contains      | Text     | Что входит в блюдо (HTML)          |
| allergens     | Text     | Аллергены (JSON строка)            |
| tags          | Text     | Теги (JSON строка)                 |
| pairings      | Text     | Парные блюда/вина (JSON строка)    |
| image         | Text     | Информация об изображении (JSON)   |
| i18n          | Text     | Переводы (JSON строка)             |
| created_at    | DateTime | Дата создания записи               |
| updated_at    | DateTime | Дата последнего обновления         |

## Файлы базы данных

- **`backend/database.db`** - файл базы данных SQLite (создаётся автоматически)
- Этот файл уже добавлен в `.gitignore`, так что не будет попадать в git

## Преимущества SQLite

1. **Простота** - один файл `database.db`, легко переносить и бэкапить
2. **Скорость** - быстрее работа с большим количеством записей
3. **Надёжность** - база данных обеспечивает целостность данных
4. **Масштабируемость** - легко перейти на PostgreSQL или MySQL в будущем

## Что делать если нужно вернуться к JSON?

Если по какой-то причине нужно вернуться к JSON, можно экспортировать данные:

```python
# Скрипт для экспорта в JSON
from app import app
from models import db, Dish
import json

with app.app_context():
    dishes = Dish.query.all()
    data = [dish.to_dict() for dish in dishes]
    with open('export.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
```
